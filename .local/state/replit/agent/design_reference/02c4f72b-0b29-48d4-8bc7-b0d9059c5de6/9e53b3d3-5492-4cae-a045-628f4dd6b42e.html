<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowForge AI - Visual AI Agent Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#059669',
                        accent: '#dc2626',
                        node: {
                            input: '#3b82f6',
                            processing: '#10b981',
                            ai: '#f59e0b',
                            output: '#ef4444'
                        }
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .node-connector { position: absolute; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #fff; }
        .node-connector.input { left: -6px; top: 50%; transform: translateY(-50%); }
        .node-connector.output { right: -6px; top: 50%; transform: translateY(-50%); }
        .workflow-canvas { 
            background-image: radial-gradient(circle, #e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .connection-line {
            position: absolute;
            height: 2px;
            background: #6b7280;
            transform-origin: left center;
            z-index: 1;
        }
        .sidebar-transition { transition: width 0.3s ease-in-out; }
        .node-dragging { z-index: 1000; transform: rotate(2deg); }
    </style>
</head>
<body class="bg-gray-50 font-inter overflow-hidden">
    
    <!-- @COMPONENT: Header Navigation -->
    <header class="bg-white border-b border-gray-200 px-6 py-3 flex items-center justify-between z-20 relative">
        <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                    <i class="fas fa-brain text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-900">FlowForge AI</h1>
            </div>
            
            <nav class="hidden md:flex items-center space-x-1">
                <button class="px-3 py-2 text-sm font-medium text-primary bg-primary/10 rounded-lg">Workflows</button>
                <button class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100">Templates</button>
                <button class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100">Agents</button>
                <button class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100">Docs</button>
            </nav>
        </div>

        <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-600" data-bind="workflow.name">Customer Support Agent</span>
                <div class="flex items-center space-x-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-xs text-gray-500">Saved</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-2">
                <button class="px-3 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50" data-event="click:handleSave">
                    <i class="fas fa-save mr-2"></i>Save
                </button>
                <button class="px-3 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90" data-event="click:handleExecute">
                    <i class="fas fa-play mr-2"></i>Execute
                </button>
            </div>

            <div class="flex items-center space-x-2">
                <button class="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-bell"></i>
                </button>
                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                    <span class="text-white text-sm font-medium" data-bind="user.initials">JD</span>
                </div>
            </div>
        </div>
    </header>
    <!-- @END_COMPONENT: Header Navigation -->

    <div class="flex h-screen pt-16">
        
        <!-- @COMPONENT: Left Sidebar - Node Library -->
        <div class="w-80 bg-white border-r border-gray-200 flex flex-col sidebar-transition" id="leftSidebar">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-semibold text-gray-900">Components</h3>
                    <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:toggleLeftSidebar">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="relative">
                    <input type="text" placeholder="Search components..." class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    <i class="fas fa-search absolute right-3 top-2.5 text-gray-400"></i>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4">
                <!-- @STATE: selectedCategory:string = 'inputs' -->
                <div class="space-y-4">
                    
                    <!-- Input Nodes -->
                    <div>
                        <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Inputs</h4>
                        <div class="space-y-2">
                            <!-- @MAP: inputNodes.map(node => ( -->
                            <div class="p-3 bg-node-input/10 border border-node-input/20 rounded-lg cursor-pointer hover:bg-node-input/20 transition-colors" draggable="true" data-node-type="webhook">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-input rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Webhook</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Trigger workflows via HTTP requests</p>
                            </div>

                            <div class="p-3 bg-node-input/10 border border-node-input/20 rounded-lg cursor-pointer hover:bg-node-input/20 transition-colors" draggable="true" data-node-type="manual">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-input rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Manual Trigger</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Start workflows manually</p>
                            </div>

                            <div class="p-3 bg-node-input/10 border border-node-input/20 rounded-lg cursor-pointer hover:bg-node-input/20 transition-colors" draggable="true" data-node-type="schedule">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-input rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Schedule</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Run workflows on a schedule</p>
                            </div>
                            <!-- @END_MAP )) -->
                        </div>
                    </div>

                    <!-- AI Nodes -->
                    <div>
                        <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">AI Agents</h4>
                        <div class="space-y-2">
                            <div class="p-3 bg-node-ai/10 border border-node-ai/20 rounded-lg cursor-pointer hover:bg-node-ai/20 transition-colors" draggable="true" data-node-type="openai">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-ai rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">OpenAI Chat</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">GPT-powered conversational AI</p>
                            </div>

                            <div class="p-3 bg-node-ai/10 border border-node-ai/20 rounded-lg cursor-pointer hover:bg-node-ai/20 transition-colors" draggable="true" data-node-type="agent">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-ai rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">AI Agent</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Multi-tool AI agent with memory</p>
                            </div>

                            <div class="p-3 bg-node-ai/10 border border-node-ai/20 rounded-lg cursor-pointer hover:bg-node-ai/20 transition-colors" draggable="true" data-node-type="vector">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-ai rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Vector Search</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Semantic search and retrieval</p>
                            </div>
                        </div>
                    </div>

                    <!-- Processing Nodes -->
                    <div>
                        <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Processing</h4>
                        <div class="space-y-2">
                            <div class="p-3 bg-node-processing/10 border border-node-processing/20 rounded-lg cursor-pointer hover:bg-node-processing/20 transition-colors" draggable="true" data-node-type="code">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-processing rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Code</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Execute JavaScript/Python code</p>
                            </div>

                            <div class="p-3 bg-node-processing/10 border border-node-processing/20 rounded-lg cursor-pointer hover:bg-node-processing/20 transition-colors" draggable="true" data-node-type="condition">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-processing rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Condition</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Branch workflow based on conditions</p>
                            </div>

                            <div class="p-3 bg-node-processing/10 border border-node-processing/20 rounded-lg cursor-pointer hover:bg-node-processing/20 transition-colors" draggable="true" data-node-type="merge">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-processing rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Merge</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Combine multiple data streams</p>
                            </div>
                        </div>
                    </div>

                    <!-- Output Nodes -->
                    <div>
                        <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Outputs</h4>
                        <div class="space-y-2">
                            <div class="p-3 bg-node-output/10 border border-node-output/20 rounded-lg cursor-pointer hover:bg-node-output/20 transition-colors" draggable="true" data-node-type="email">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-output rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Send Email</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Send emails via SMTP</p>
                            </div>

                            <div class="p-3 bg-node-output/10 border border-node-output/20 rounded-lg cursor-pointer hover:bg-node-output/20 transition-colors" draggable="true" data-node-type="webhook-response">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-node-output rounded-full"></div>
                                    <span class="text-sm font-medium text-gray-900">Webhook Response</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Return data to webhook caller</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: Left Sidebar -->

        <!-- @COMPONENT: Main Canvas Area -->
        <div class="flex-1 flex flex-col">
            <!-- Canvas Toolbar -->
            <div class="bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <button class="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100" data-event="click:zoomOut">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <span class="text-sm text-gray-600" data-bind="canvas.zoom">100%</span>
                        <button class="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100" data-event="click:zoomIn">
                            <i class="fas fa-search-plus"></i>
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button class="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100" data-event="click:undo">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100" data-event="click:redo">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>

                <div class="flex items-center space-x-2">
                    <div class="flex items-center space-x-1 bg-green-50 text-green-700 px-3 py-1 rounded-full text-sm">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span data-bind="execution.status">Ready</span>
                    </div>
                    <button class="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100" data-event="click:toggleMinimap">
                        <i class="fas fa-map"></i>
                    </button>
                </div>
            </div>

            <!-- Canvas -->
            <div class="flex-1 relative overflow-hidden workflow-canvas bg-gray-50" id="workflowCanvas">
                <!-- @FUNCTIONALITY: This canvas should implement drag-and-drop workflow building with visual connections -->
                
                <!-- Sample Workflow Nodes -->
                
                <!-- Manual Trigger Node -->
                <div class="absolute top-20 left-20 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hover:shadow-xl transition-shadow cursor-move" data-node-id="trigger-1" style="position: absolute; top: 80px; left: 80px;">
                    <div class="p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-3 h-3 bg-node-input rounded-full"></div>
                            <span class="text-sm font-semibold text-gray-900">Manual Trigger</span>
                            <div class="ml-auto">
                                <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:deleteNode">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600">Workflow starts here</p>
                    </div>
                    <div class="node-connector output bg-node-input"></div>
                </div>

                <!-- OpenAI Chat Node -->
                <div class="absolute bg-white rounded-lg shadow-lg border border-gray-200 hover:shadow-xl transition-shadow cursor-move" data-node-id="openai-1" style="position: absolute; top: 80px; left: 400px; width: 200px;">
                    <div class="p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-3 h-3 bg-node-ai rounded-full"></div>
                            <span class="text-sm font-semibold text-gray-900">OpenAI Chat</span>
                            <div class="ml-auto">
                                <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:deleteNode">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Customer support assistant</p>
                        <div class="text-xs text-gray-500">
                            <div>Model: gpt-4</div>
                            <div>Temperature: 0.7</div>
                        </div>
                    </div>
                    <div class="node-connector input bg-node-ai"></div>
                    <div class="node-connector output bg-node-ai"></div>
                </div>

                <!-- Condition Node -->
                <div class="absolute bg-white rounded-lg shadow-lg border border-gray-200 hover:shadow-xl transition-shadow cursor-move" data-node-id="condition-1" style="position: absolute; top: 80px; left: 700px; width: 180px;">
                    <div class="p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-3 h-3 bg-node-processing rounded-full"></div>
                            <span class="text-sm font-semibold text-gray-900">Condition</span>
                            <div class="ml-auto">
                                <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:deleteNode">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Check sentiment score</p>
                        <div class="text-xs text-gray-500">sentiment > 0.7</div>
                    </div>
                    <div class="node-connector input bg-node-processing"></div>
                    <div class="node-connector output bg-green-500" style="top: 30%; right: -6px;"></div>
                    <div class="node-connector output bg-red-500" style="top: 70%; right: -6px;"></div>
                </div>

                <!-- Send Email Node -->
                <div class="absolute bg-white rounded-lg shadow-lg border border-gray-200 hover:shadow-xl transition-shadow cursor-move" data-node-id="email-1" style="position: absolute; top: 50px; left: 980px; width: 180px;">
                    <div class="p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-3 h-3 bg-node-output rounded-full"></div>
                            <span class="text-sm font-semibold text-gray-900">Send Email</span>
                            <div class="ml-auto">
                                <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:deleteNode">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Positive feedback alert</p>
                        <div class="text-xs text-gray-500">To: support@company.com</div>
                    </div>
                    <div class="node-connector input bg-node-output"></div>
                </div>

                <!-- Escalate Node -->
                <div class="absolute bg-white rounded-lg shadow-lg border border-gray-200 hover:shadow-xl transition-shadow cursor-move" data-node-id="escalate-1" style="position: absolute; top: 150px; left: 980px; width: 180px;">
                    <div class="p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-3 h-3 bg-node-output rounded-full"></div>
                            <span class="text-sm font-semibold text-gray-900">Escalate</span>
                            <div class="ml-auto">
                                <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:deleteNode">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Create support ticket</p>
                        <div class="text-xs text-gray-500">Priority: High</div>
                    </div>
                    <div class="node-connector input bg-node-output"></div>
                </div>

                <!-- Connection Lines -->
                <svg class="absolute inset-0 pointer-events-none" style="z-index: 1;">
                    <!-- Connection from trigger to OpenAI -->
                    <path d="M 272 112 Q 320 112 320 112 T 400 112" stroke="#6b7280" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                    
                    <!-- Connection from OpenAI to Condition -->
                    <path d="M 600 112 Q 650 112 650 112 T 700 112" stroke="#6b7280" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                    
                    <!-- Connection from Condition to Send Email (positive) -->
                    <path d="M 886 102 Q 930 102 930 82 T 980 82" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                    
                    <!-- Connection from Condition to Escalate (negative) -->
                    <path d="M 886 122 Q 930 122 930 182 T 980 182" stroke="#ef4444" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                    
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"/>
                        </marker>
                    </defs>
                </svg>

                <!-- Drop Zone Indicator (hidden by default) -->
                <div class="absolute inset-0 pointer-events-none opacity-0 transition-opacity" id="dropZone">
                    <div class="w-full h-full border-2 border-dashed border-primary bg-primary/5 flex items-center justify-center">
                        <div class="text-primary font-medium">Drop node here to add to workflow</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: Main Canvas Area -->

        <!-- @COMPONENT: Right Sidebar - Properties Panel -->
        <div class="w-80 bg-white border-l border-gray-200 flex flex-col sidebar-transition" id="rightSidebar">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-sm font-semibold text-gray-900">Properties</h3>
                    <button class="p-1 text-gray-400 hover:text-gray-600" data-event="click:toggleRightSidebar">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4">
                <!-- @STATE: selectedNode:object = null -->
                
                <!-- Node Properties (when node is selected) -->
                <div id="nodeProperties" data-mock="true">
                    <div class="space-y-4">
                        <!-- Node Header -->
                        <div class="flex items-center space-x-3 p-3 bg-node-ai/10 rounded-lg">
                            <div class="w-4 h-4 bg-node-ai rounded-full"></div>
                            <div>
                                <h4 class="text-sm font-semibold text-gray-900" data-bind="selectedNode.name">OpenAI Chat</h4>
                                <p class="text-xs text-gray-600" data-bind="selectedNode.id">openai-1</p>
                            </div>
                        </div>

                        <!-- Configuration Sections -->
                        <div class="space-y-4">
                            <!-- Model Configuration -->
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2">Model Configuration</label>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                        <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                            <option value="gpt-4">GPT-4</option>
                                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Temperature</label>
                                        <input type="range" min="0" max="1" step="0.1" value="0.7" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>0 (Deterministic)</span>
                                            <span>1 (Creative)</span>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Max Tokens</label>
                                        <input type="number" value="150" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    </div>
                                </div>
                            </div>

                            <!-- System Prompt -->
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2">System Prompt</label>
                                <textarea rows="4" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="You are a helpful customer support assistant...">You are a helpful customer support assistant. Analyze customer messages and provide appropriate responses. Focus on being empathetic and solution-oriented.</textarea>
                            </div>

                            <!-- Memory Configuration -->
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2">Memory</label>
                                <div class="space-y-3">
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" id="enableMemory" class="rounded border-gray-300 text-primary focus:ring-primary" checked>
                                        <label for="enableMemory" class="text-sm text-gray-700">Enable conversation memory</label>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Memory Window</label>
                                        <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                            <option value="10">Last 10 messages</option>
                                            <option value="20">Last 20 messages</option>
                                            <option value="50">Last 50 messages</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Tools -->
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2">Available Tools</label>
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-3 p-2 border border-gray-200 rounded-lg">
                                        <input type="checkbox" id="searchTool" class="rounded border-gray-300 text-primary focus:ring-primary" checked>
                                        <div class="flex-1">
                                            <label for="searchTool" class="text-sm font-medium text-gray-700">Knowledge Search</label>
                                            <p class="text-xs text-gray-500">Search company knowledge base</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 p-2 border border-gray-200 rounded-lg">
                                        <input type="checkbox" id="ticketTool" class="rounded border-gray-300 text-primary focus:ring-primary">
                                        <div class="flex-1">
                                            <label for="ticketTool" class="text-sm font-medium text-gray-700">Create Ticket</label>
                                            <p class="text-xs text-gray-500">Create support tickets</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Test Section -->
                        <div class="border-t border-gray-200 pt-4">
                            <button class="w-full px-4 py-2 text-sm font-medium text-primary border border-primary rounded-lg hover:bg-primary/5" data-event="click:testNode">
                                <i class="fas fa-play mr-2"></i>Test Node
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Workflow Properties (when no node selected) -->
                <div id="workflowProperties" class="hidden" data-mock="true">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2">Workflow Settings</label>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                    <input type="text" value="Customer Support Agent" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea rows="3" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Describe your workflow...">AI-powered customer support workflow that analyzes customer messages and provides appropriate responses or escalations.</textarea>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2">Execution Settings</label>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3">
                                    <input type="checkbox" id="errorHandling" class="rounded border-gray-300 text-primary focus:ring-primary" checked>
                                    <label for="errorHandling" class="text-sm text-gray-700">Continue on error</label>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Timeout (seconds)</label>
                                    <input type="number" value="300" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: Right Sidebar -->
    </div>

    <!-- @COMPONENT: Template Gallery Modal (hidden by default) -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="templateModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-90vh overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-bold text-gray-900">Workflow Templates</h2>
                        <button class="p-2 text-gray-400 hover:text-gray-600" data-event="click:closeTemplateModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p class="text-gray-600 mt-2">Choose from pre-built templates to get started quickly</p>
                </div>
                
                <div class="p-6 overflow-y-auto max-h-96">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Template Cards -->
                        <div class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer" data-template="customer-support">
                            <h3 class="font-semibold text-gray-900 mb-2">Customer Support Agent</h3>
                            <p class="text-sm text-gray-600 mb-3">AI agent that handles customer inquiries with sentiment analysis and escalation</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span class="bg-node-input/20 text-node-input px-2 py-1 rounded">Webhook</span>
                                <span class="bg-node-ai/20 text-node-ai px-2 py-1 rounded">AI Chat</span>
                                <span class="bg-node-output/20 text-node-output px-2 py-1 rounded">Email</span>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer" data-template="content-generator">
                            <h3 class="font-semibold text-gray-900 mb-2">Content Generator</h3>
                            <p class="text-sm text-gray-600 mb-3">Generate blog posts, social media content, and marketing materials</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span class="bg-node-input/20 text-node-input px-2 py-1 rounded">Manual</span>
                                <span class="bg-node-ai/20 text-node-ai px-2 py-1 rounded">GPT-4</span>
                                <span class="bg-node-processing/20 text-node-processing px-2 py-1 rounded">Format</span>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer" data-template="data-analysis">
                            <h3 class="font-semibold text-gray-900 mb-2">Data Analysis Pipeline</h3>
                            <p class="text-sm text-gray-600 mb-3">Automated data processing and insight generation with visualizations</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span class="bg-node-input/20 text-node-input px-2 py-1 rounded">Schedule</span>
                                <span class="bg-node-processing/20 text-node-processing px-2 py-1 rounded">Python</span>
                                <span class="bg-node-ai/20 text-node-ai px-2 py-1 rounded">Analysis</span>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer" data-template="lead-qualification">
                            <h3 class="font-semibold text-gray-900 mb-2">Lead Qualification</h3>
                            <p class="text-sm text-gray-600 mb-3">Qualify leads automatically and route them to appropriate sales teams</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span class="bg-node-input/20 text-node-input px-2 py-1 rounded">Form</span>
                                <span class="bg-node-ai/20 text-node-ai px-2 py-1 rounded">Scoring</span>
                                <span class="bg-node-output/20 text-node-output px-2 py-1 rounded">CRM</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: Template Gallery Modal -->

    <script>
        // TODO: Implement business logic, API calls, and state management
        (function() {
            // Canvas interaction management
            let isDragging = false;
            let dragOffset = { x: 0, y: 0 };
            let selectedNode = null;

            // Initialize drag and drop functionality
            function initializeDragDrop() {
                const canvas = document.getElementById('workflowCanvas');
                const sidebar = document.querySelector('#leftSidebar');
                const nodeLibrary = sidebar.querySelectorAll('[draggable="true"]');

                // Handle node library drag start
                nodeLibrary.forEach(node => {
                    node.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', e.target.dataset.nodeType);
                        e.dataTransfer.effectAllowed = 'copy';
                    });
                });

                // Handle canvas drop
                canvas.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                });

                canvas.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const nodeType = e.dataTransfer.getData('text/plain');
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // TODO: Create new node at position (x, y) with type nodeType
                    console.log(`Creating ${nodeType} node at (${x}, ${y})`);
                });
            }

            // Node selection management
            function initializeNodeSelection() {
                const canvas = document.getElementById('workflowCanvas');
                
                canvas.addEventListener('click', (e) => {
                    const node = e.target.closest('[data-node-id]');
                    if (node) {
                        selectNode(node);
                        e.stopPropagation();
                    } else {
                        deselectAllNodes();
                    }
                });
            }

            function selectNode(nodeElement) {
                // Remove previous selections
                document.querySelectorAll('[data-node-id]').forEach(n => {
                    n.classList.remove('ring-2', 'ring-primary');
                });
                
                // Add selection to current node
                nodeElement.classList.add('ring-2', 'ring-primary');
                selectedNode = nodeElement;
                
                // Show properties panel for selected node
                document.getElementById('nodeProperties').classList.remove('hidden');
                document.getElementById('workflowProperties').classList.add('hidden');
                
                // TODO: Load node properties into the properties panel
                console.log('Selected node:', nodeElement.dataset.nodeId);
            }

            function deselectAllNodes() {
                document.querySelectorAll('[data-node-id]').forEach(n => {
                    n.classList.remove('ring-2', 'ring-primary');
                });
                selectedNode = null;
                
                // Show workflow properties
                document.getElementById('nodeProperties').classList.add('hidden');
                document.getElementById('workflowProperties').classList.remove('hidden');
            }

            // Sidebar toggle functionality
            function initializeSidebarToggles() {
                const leftSidebar = document.getElementById('leftSidebar');
                const rightSidebar = document.getElementById('rightSidebar');
                
                document.querySelector('[data-event="click:toggleLeftSidebar"]').addEventListener('click', () => {
                    leftSidebar.classList.toggle('w-80');
                    leftSidebar.classList.toggle('w-0');
                });
                
                document.querySelector('[data-event="click:toggleRightSidebar"]').addEventListener('click', () => {
                    rightSidebar.classList.toggle('w-80');
                    rightSidebar.classList.toggle('w-0');
                });
            }

            // Template modal functionality
            function initializeTemplateModal() {
                const modal = document.getElementById('templateModal');
                const closeBtn = document.querySelector('[data-event="click:closeTemplateModal"]');
                
                // TODO: Add open template modal logic
                
                closeBtn.addEventListener('click', () => {
                    modal.classList.add('hidden');
                });
                
                // Handle template selection
                modal.addEventListener('click', (e) => {
                    const template = e.target.closest('[data-template]');
                    if (template) {
                        const templateType = template.dataset.template;
                        // TODO: Load template workflow
                        console.log('Loading template:', templateType);
                        modal.classList.add('hidden');
                    }
                });
            }

            // Workflow execution simulation
            function initializeExecutionControls() {
                const executeBtn = document.querySelector('[data-event="click:handleExecute"]');
                
                executeBtn.addEventListener('click', () => {
                    // TODO: Implement workflow execution logic
                    console.log('Executing workflow...');
                    
                    // Simulate execution status updates
                    const statusElement = document.querySelector('[data-bind="execution.status"]');
                    statusElement.textContent = 'Running';
                    statusElement.parentElement.className = 'flex items-center space-x-1 bg-yellow-50 text-yellow-700 px-3 py-1 rounded-full text-sm';
                    
                    setTimeout(() => {
                        statusElement.textContent = 'Completed';
                        statusElement.parentElement.className = 'flex items-center space-x-1 bg-green-50 text-green-700 px-3 py-1 rounded-full text-sm';
                    }, 3000);
                });
            }

            // Initialize all functionality
            document.addEventListener('DOMContentLoaded', () => {
                initializeDragDrop();
                initializeNodeSelection();
                initializeSidebarToggles();
                initializeTemplateModal();
                initializeExecutionControls();
                
                // Select the first node by default for demonstration
                setTimeout(() => {
                    const firstNode = document.querySelector('[data-node-id="openai-1"]');
                    if (firstNode) selectNode(firstNode);
                }, 100);
            });
        })();
    </script>
</body>
</html>